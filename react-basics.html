<!DOCTYPE html>
<html>
    <head>
        <title>CHATBOT</title>
        <link rel = "stylesheet" href = "style.css">
    </head>
    <body>

        <div class = "container"></div>

    <script src = "https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src = "https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src = "https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src = "https://unpkg.com/supersimpledev/chatbot.js"></script>

       <script type = "text/babel"> 

     function ChatInput ( {chatMessages, setChatMessages, setFirstMessageSent} ) {  {/* ADDED: setFirstMessageSent prop */}
        const [inputText, setInputText] = React.useState ('');
        
        function saveInputText(event){
            //event is an object that contains details about one event
            setInputText(event.target.value); //gives us access to the inout element
        }
        function sendMessage (){
            const newChatMessages = [
             ...chatMessages,{
                    message: inputText,
                    sender: "user",
                    id : crypto.randomUUID()

                }
            ];
             setChatMessages (newChatMessages);

            const response = Chatbot.getResponse(inputText);
                // delay robot reply by 500ms
                setTimeout(() => {
                setChatMessages([
                    ...newChatMessages,
                    {
                    message: response,
                    sender: "robot",
                    id: crypto.randomUUID()
                    }
                ]);
                }, 500);

            // ADDED: after first user send, hide the intro notice text
            setFirstMessageSent(true);

            //updater function -  the we give a prop to it to shwow in the html
            setInputText ('');
        }
        return(
            <div className = "chat-input-container">
                
            <input
                placeholder = "Type your message..." 
                size = "30"
                onChange = {saveInputText} 
                value = {inputText}  // controlled input
                className = "chat-input"
                onKeyDown={(event) => {
                    if (event.key === "Enter") {
                    sendMessage();
                    }
                }}
            />
            <button onClick = {sendMessage} className = "send-button"> SEND </button>
            </div>
        );
    }

    function ChatMessage ({message, sender, id}){
        // const message = props.message;
        // const sender = props.sender; getting deconstructed
        //const  {message, sender} = props; can also get deconstructed

       /* if(sender === "user"){ 
            return (
            <div>
                {message}
                <img src = "user.png" width = "50" />
            </div>
        );
        }*/
        return (
            <div className = {sender === 'user' ? 'chat-message-user' : 'chat-message-robot'}>
                {sender === "robot" &&
                 (<img src = "robot.png" className = "chat-message-profile"/>) } 
                 <div className = "chat-message-text">
                    {message}
                 
                 </div>
                {sender === "user" &&  /* CHANGED: == to === for strict compare */
                 (<img src = "user.png" className = "chat-message-profile"/>)}
               
            </div> //guard opertor
        );
    }

    function ChatMessages ({chatMessages}){

        const chatMessagesRef = React.useRef(null);
        React.useEffect(()=>{
            const containerElem = chatMessagesRef.current;
            if (containerElem){
                containerElem.scrollTop = containerElem.scrollHeight;
            }
        
        },[chatMessages]);
       
        return (
        <div className = "chat-messages-container" ref = {chatMessagesRef}> 
        {chatMessages.map((chatMessages) => {
            return (
                <ChatMessage 
                key = {chatMessages.id}
                message = {chatMessages.message}
                sender = {chatMessages.sender}
                id = {chatMessages.id}
                />

            );


        })}
    </div>
        );

    }

    function App (){

         const [chatMessages, setChatMessages] =  React.useState ([
           // ADDED: start with NO messages at all (empty chat)
         ]);
         const [firstMessageSent, setFirstMessageSent] = React.useState(false); // ADDED: track first send
        //const chatMessages = array[0];
       // const [chatMessages, setChatMessages] = array;
        //const setChatMessages = array[1];

        return (
           <div className = "app-container">
                {/* ADDED: plain notice text 
                    It shows only until the first user message is sent. */}
                {!firstMessageSent && (
                  <div className="intro-text">
                    Welcome to Haded Chat Bot. Ask your question!
                  </div>
                )}

                <ChatMessages chatMessages = {chatMessages}/>
                <ChatInput
                  chatMessages = {chatMessages}
                  setChatMessages = {setChatMessages}
                  setFirstMessageSent = {setFirstMessageSent}  /* ADDED: pass setter down */
                />
           </div>
        );
    }
  

    const container = document.querySelector('.container');
    ReactDOM.createRoot (container).render(<App />);

    </script>
    </body>
</html>
